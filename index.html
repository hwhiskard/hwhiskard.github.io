<!DOCTYPE html>
<html>
<head>
<title>AWE basic AR demo</title>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<meta charset="utf-8"/>
<style type="text/css">
* {
	margin: 0;
	padding: 0;
}
#container {
	position: absolute;
	left: 0;
	top: 0;
	bottom: 0;
	right: 0;
	overflow: hidden;
}
</style>
</head>
<body>
<div id="container"></div>
<script type="text/javascript" src="js/awe-v8.js"></script>
<script type="text/javascript" src="js/awe-loader.js"></script>
<script type="text/javascript">
  window.addEventListener('load', function() {
    // initialize awe after page loads
    window.awe.init({
      // automatically detect the device type
      device_type: awe.AUTO_DETECT_DEVICE_TYPE,
      // populate some default settings
      settings: {
      	container_id: 'container',
        fps: 30,
        default_camera_position: { x:0, y:0, z:0 },
        default_lights:[
          {
            id: 'hemisphere_light',
            type: 'hemisphere',
            color: 0xCCCCCC
          },
        ],
      },
      ready: function() {
        var d = '?_='+Date.now();

        // load js files based on capability detection then setup the scene if successful
        awe.util.require([
          {
            capabilities: ['webgl','gum'],
            files: [
              [ 'js/awe-standard-dependencies.js'+d, 'js/awe-standard.js'+d ], // core dependencies for this app
              ['js/plugins/StereoEffect.js'+d, 'js/plugins/VREffect.js'+d], // dependencies for render effects
              'js/plugins/awe.rendering_effects.js'+d,
              'js/plugins/awe-standard-object_clicked_or_focused.js'+d, // object click/tap handling plugin
              'examples/basic/awe.gyro.js'+d, // basic gyro handling
              'examples/basic/awe.mouse.js'+d, // basic mouse handling
            ],
            success: function() {
              // setup and paint the scene
			        awe.setup_scene();

  						var click_plugin = awe.plugins.view('object_clicked');
  						if (click_plugin) {
    						click_plugin.register();
    						click_plugin.enable();
  						}
  						var gyro_plugin = awe.plugins.view('gyro');
  						if (gyro_plugin) {
    						gyro_plugin.enable();
  						}
  						var mouse_plugin = awe.plugins.view('gyro');
  						if (gyro_plugin) {
    						gyro_plugin.enable();
  						}

              awe.settings.update({data:{value: 'ar'}, where:{id: 'view_mode'}})
  						var render_effects_plugin = awe.plugins.view('render_effects');
  						if (render_effects_plugin) {
    						render_effects_plugin.enable();
  						}

              // setup some code to handle when an object is clicked/tapped
              window.addEventListener('object_clicked', function(e) {
                var p = awe.projections.view(e.detail.projection_id);
                awe.projections.update({ // rotate clicked object by 180 degrees around x and y axes over 10 seconds
                  data:{
                    animation: {
                      duration: 10,
                    },
                    rotation:{ y: p.rotation.y+180, x: p.rotation.x+180 }
                  },
                  where:{ id:e.detail.projection_id }
                });
              }, false);

							var new_x = 0, // start pov position at x:0
    new_z = 0, // start the pov position at z:0
    duration = 3, // make the animation run for 3 seconds
    step_size = 360/(duration*61), // if duration == 1 & rAF runs at ~60hz
    circle_radius = 400,
    angle = 0,
    target_poi_id = "fixedObj", // set the poi you want to circle around
      target_poi_x = awe.pois.view(target_poi_id).position.x,
      target_poi_z = awe.pois.view(target_poi_id).position.z;
awe.pov().update({
  position:{ x:1 }, // set an arbitrary non zero position update but override it below
  animation: {
        duration: duration,
        persist: 0, // change this to 1 if you don't want to reset to how you started
        step_callback:function(io) {  // setup a callback on each step
          angle += step_size; // update the current angle
          new_x = Math.sin(THREE.Math.degToRad(angle))*circle_radius ; // calculate the x based on angle
          new_z = Math.cos(THREE.Math.degToRad(angle))*circle_radius ; // calculate the z based on angle
          awe.pov().update({ position:{ x:target_poi_x+new_x, z:target_poi_z+new_z } }); // update offset from the poi you're circling
          io.object.look_at_poi({ id:target_poi_id  }); // make the pov look at the poi you're circling
        },
        end_callback:function(io) {
          io.object.look_at_poi({ id:target_poi_id  }); // if you don't persist then reset orientation here
        }
    }
});

            },
          },
          { // else create a fallback
            capabilities: [],
            files: [],
            success: function() {
              document.body.innerHTML = '<p>This demo currently requires a standards compliant mobile browser.';
              return;
            },
          },
        ]);
      }
    });
  });
</script>
</body>
</html>
